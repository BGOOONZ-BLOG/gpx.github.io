<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.835962e22f0584898860.css">*,:after,:before{box-sizing:border-box}::selection,:not(pre) code[class*=language-]::selection{background:rgba(3,169,244,.2)}html{font-size:19px}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;color:#333;line-height:1.5;margin:0}a{text-decoration:none;color:currentColor}code[class*=language-],pre[class*=language-]{font-family:Ubuntu Mono,monospace;font-size:.9em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:hsla(0,0%,100%,.13)}pre[class*=language-]{padding:1em;margin:0 0 .5em;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#1e272e;border-radius:0 0 .5em .5em;color:#d2dae2}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:rgba(0,0,0,.07);color:inherit}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#808e9b;font-style:italic}.token.punctuation{color:#808e9b}.namespace{color:red;background:red}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#ffa801}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#0be881}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#ffd32a}.token.atrule,.token.attr-value,.token.keyword{color:#ef5777}.token.class-name,.token.function{color:#0fbcf9}.token.important,.token.regex,.token.variable{color:#0be881}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.gatsby-highlight-code-line{background:#2f3d48;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #575fcf}.gatsby-highlight:before{content:attr(data-language);display:block;padding:.3em 1em;font-size:.9em;text-transform:uppercase;text-align:right;background-image:linear-gradient(90deg,#7986cb,#3f51b5);color:#fff;font-family:Ubuntu Mono,monospace;border-radius:.5em .5em 0 0}.gatsby-highlight[data-language=html]:before{background-image:linear-gradient(90deg,#ffb74d,#ff9800)}.gatsby-highlight[data-language=text]:before{content:" ";white-space:pre;background-image:linear-gradient(90deg,#dce775,#cddc39)}.gatsby-highlight{border-radius:.5em;box-shadow:2px 2px 3px 2px rgba(0,0,0,.2);margin:2em 0}article{margin-bottom:4em;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;hyphenate-limit-chars:6 3 2;hyphenate-limit-lines:2;hyphenate-limit-last:always;-webkit-text-decoration-skip:ink;text-decoration-skip-ink:auto}article h1{font-size:2rem;margin:1.5em 0;text-align:center;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}article h2{text-align:left;font-size:1.3rem;margin:2em 0 1em}article p:first-child:first-line{font-weight:600}article a{text-decoration:underline}article figure{margin:auto auto 3em;text-align:center}article img{max-width:100%}article figcaption{text-align:center;font-style:italic}hr{border:none;border-radius:50%;margin:2em auto}hr,hr:after,hr:before{height:3px;width:3px;background:rgba(0,0,0,.67)}hr:after,hr:before{position:absolute;content:"";display:inline-block;border-radius:50%;padding:0}hr:before{transform:translateX(-1em)}hr:after{transform:translateX(1em)}article .highlight{text-align:left;-webkit-hyphens:initial;-ms-hyphens:initial;hyphens:manual;font-size:1.3em;color:#666;margin:1.7em;font-weight:100;padding-bottom:.5em;border-bottom:3px solid #3f51b5}article ul{text-align:left;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}article li{margin-bottom:.5em}details.tldr{border:1px solid rgba(0,0,0,.2);padding:.4em 1em;margin-bottom:4rem}details summary{cursor:pointer}twitter-widget{margin:2em auto!important}blockquote{text-align:left;-webkit-hyphens:initial;-ms-hyphens:initial;hyphens:manual;margin:2em auto;max-width:80%;font-size:1.2em;font-style:italic}blockquote p:first-child:first-line{font-weight:400}</style><meta name="generator" content="Gatsby 2.20.23"/><title data-react-helmet="true">Making Sense of &lt;code&gt;useEffect&lt;/code&gt;</title><meta data-react-helmet="true" property="og:title" content="Making Sense of &lt;code&gt;useEffect&lt;/code&gt;"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:url" content="https://www.polvara.me/posts/making-sense-of-useeffect/"/><meta data-react-helmet="true" property="og:image" content="https://www.polvara.meundefined"/><style data-styled="" data-styled-version="5.1.0">.fscSeJ{display:block;max-width:500px;margin:auto;margin-top:3em;box-shadow:2px 2px 3px 2px #0003;padding:2em 2.5em;text-align:center;-webkit-transition:-webkit-transform 0.2s;-webkit-transition:transform 0.2s;transition:transform 0.2s;border-radius:6px;}/*!sc*/
data-styled.g1[id="newsletter-form__Card-a2ms4a-0"]{content:"fscSeJ,"}/*!sc*/
.eyKXbm{color:red;}/*!sc*/
data-styled.g2[id="newsletter-form__Button-a2ms4a-1"]{content:"eyKXbm,"}/*!sc*/
.KHPza{margin:0;font-size:1.6em;font-weight:500;line-height:1;}/*!sc*/
data-styled.g4[id="newsletter-form__Title-a2ms4a-3"]{content:"KHPza,"}/*!sc*/
.dYhHPN{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin-top:2em;}/*!sc*/
.dYhHPN label{text-align:left;margin-bottom:0.3em;}/*!sc*/
.dYhHPN [type="email"]{font-size:1.3em;border:1px solid #333;padding:0.3em 0.6em;border-radius:6px;margin-bottom:0.5em;}/*!sc*/
.dYhHPN [type="submit"]{background:#3a6;border:none;font-size:1.3em;padding:0.6em;color:#fff;text-shadow:1px 0 1px #0004;border-radius:6px;cursor:pointer;}/*!sc*/
data-styled.g6[id="newsletter-form__InputGroup-a2ms4a-5"]{content:"dYhHPN,"}/*!sc*/
.jBIpkR{margin-top:4em;padding:3em 0.5em;text-align:right;background:#3a6;color:#fff;text-shadow:1px 0 1px #0004;}/*!sc*/
data-styled.g7[id="footer__Container-sc-1abtvul-0"]{content:"jBIpkR,"}/*!sc*/
.ihWmWm{max-width:calc(65 * 9px);margin:auto;}/*!sc*/
.ihWmWm > *{margin:0.7em;}/*!sc*/
.ihWmWm > *:first-child{margin-left:0;}/*!sc*/
.ihWmWm > *:last-child{margin-right:0;}/*!sc*/
data-styled.g8[id="footer__Content-sc-1abtvul-1"]{content:"ihWmWm,"}/*!sc*/
.bcrfyt{max-width:calc(65 * 9px);margin:auto;font-size:0.85em;margin-top:1em;}/*!sc*/
data-styled.g9[id="footer__Copy-sc-1abtvul-2"]{content:"bcrfyt,"}/*!sc*/
.cCMnR{padding:0 0.5em;max-width:calc(65 * 9px);margin:auto;}/*!sc*/
data-styled.g10[id="layout__Container-sc-4dh0yk-0"]{content:"cCMnR,"}/*!sc*/
.fsQVfs{display:block;font-weight:500;font-size:1.5rem;text-align:center;padding:0.5em 0;color:#fff;text-shadow:1px 0 1px #0004;-webkit-text-decoration:none;text-decoration:none;width:100%;background:#3a6;}/*!sc*/
data-styled.g20[id="post-header__Title-sc-1okepgc-0"]{content:"fsQVfs,"}/*!sc*/
.jOkvKZ{display:block;font-size:0.45em;font-weight:400;color:#666;margin-top:0.5em;}/*!sc*/
data-styled.g21[id="blog-post__Meta-sc-7gkdnd-0"]{content:"jOkvKZ,"}/*!sc*/
.duvUWk{font-size:0.85rem;text-align:center;margin-bottom:3rem;padding:0.5em 0;background:#e8eaf6;}/*!sc*/
.duvUWk a{-webkit-text-decoration:underline;text-decoration:underline;}/*!sc*/
data-styled.g22[id="blog-post__Footer-sc-7gkdnd-1"]{content:"duvUWk,"}/*!sc*/
</style><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/ubuntumono/v9/KFOjCneDtsqEr0keqCMhbCc6CsQ.woff2"/><style type="text/css">@font-face{font-family:'Ubuntu Mono';font-style:normal;font-weight:400;src:local('Ubuntu Mono'),local('UbuntuMono-Regular'),url(/google-fonts/s/ubuntumono/v9/KFOjCneDtsqEr0keqCMhbCc6CsQ.woff2) format('woff2'),url(/google-fonts/s/ubuntumono/v9/KFOjCneDtsqEr0keqCMhbCc6CsI.woff) format('woff');font-display: swap;}</style><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-109c4be61e355b7b21f8.js"/><link as="script" rel="preload" href="/framework-c88d07efb40e009babfb.js"/><link as="script" rel="preload" href="/app-04a92f08d6fc44f9844d.js"/><link as="script" rel="preload" href="/styles-b729c27faa6284e9ff45.js"/><link as="script" rel="preload" href="/cd7d5f864fc9e15ed8adef086269b0aeff617554-b178ff70968fed9b073a.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-823b0b2f1756e4d4d7a7.js"/><link as="fetch" rel="preload" href="/page-data/posts/making-sense-of-useeffect/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><a class="post-header__Title-sc-1okepgc-0 fsQVfs" href="/">Giorgio Polvara&#x27;s Blog</a><div class="layout__Container-sc-4dh0yk-0 cCMnR"><article lang="en"><h1><span>Making Sense of <code>useEffect</code></span><span class="blog-post__Meta-sc-7gkdnd-0 jOkvKZ">Approximately <!-- -->4<!-- --> min read</span></h1><figure><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:66.63461538461539%"></div><img aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%20width=&#x27;400&#x27;%20height=&#x27;267&#x27;%20viewBox=&#x27;0%200%20400%20267&#x27;%20preserveAspectRatio=&#x27;none&#x27;%3e%3cpath%20d=&#x27;M0%2026v25h6a527%20527%200%200188%201l3-1%201-2c4-2%200-27-7-41l-3-8H0v26M96%209l11%2035c1%203%201%204%202%203l1%201c-1%202-1%202%201%202%2013-6%2024-5%2036%204%206%204%2021%208%2045%2011a482%20482%200%200167%2015c11%202%2030%207%2031%209h3c2-1%203%200%204%202h-1v1l-1%201h-1l-1%201c-2%200-11%209-12%2012-1%202-1%204%201%209%201%206%201%2016-1%2020-1%201-1%201-1-1%202-8%202-11%201-16-1-7-2-7-5%200l-3%209-2%205-2%205-2%207-1%204-3-2-3-3-2%203-2%205c0%201-2%202-5%202h-5l-11%201c-8%201-9%201-11-1l-1-2c1-1%200-4-4-13l-4-10c0-2-4-7-4-5%200%205-9%2022-11%2021l1-3c5-5%2010-19%208-22-3-5-4-5-8-1-3%202-4%205-2%2015l-1%208c-1%203-1%204%201%204v2l-2%203c0%205-2%206-29%206l-33%202c-17%204-16%204%204%203%2011-1%2051-2%2058-1%201%200%202%201%202%206v21l-35%201c-31%200-40%201-34%202%203%202%2019%202%2022%201h4l12%202a396%20396%200%200030%204c1%201%201%201-1%201l1%201%202%203c-1%203-9%206-12%204h-12l-6%202c-6%200-5%202%201%202l3%201h-53v1h-18c-6%200-10%200-9-1H83c-12%200-19%201-17%203l-6%201c-7-1-9-2-3-2s5-1-4-2l-12-3-4-2h7l-4-2c-6-1-7-5-5-9%201-3%203-14%201-14l-15%2010%202%203c3%203%203%205%200%207l-4%203-5%202-5%202-2%201-1%201-2%201c-1%201%200%201%202%201%208%200%209%200%208%202l2%201c2%200%202%200%201%201-2%201-2%201%201%201h3l-3%201c-4%202-5%202-3%203H0v46h401l-1-55V0H92l4%209m-73%2098c-1%202%200%204%202%204l1%202c1%202%207%204%2013%203l4-1%201-2%203-2%202-1c1-1-8-4-17-5-7%200-8%200-9%202m316-1l2%201%201%201%201%202c4%200%208%205%209%209%200%203%201%204%204%204l5%202c2%201%209%200%209-1%201-2-1-4-2-3l-1-2-3-2-6-3-6-3-1-1-2-2-4-2h-6m-43%2014l-3%202%203-1c7-3%2011%202%2013%2015%200%206%200%207-3%205l-14-1c-13-1-11%201%202%201%209%201%2015%203%2015%207l5%203c5%202%206%200%201-4-3-3-4-5-4-9-2-9-4-16-7-18s-4-2-8%200M25%20130c-4%205-9%2017-9%2021%200%205-4%208-11%208H1v9h9c10%200%2012%200%2012%203-1%201%200%202%201%203v1c-3%200-6%206-5%209%201%204%203%204%209%200%205-3%206-4%205-5s-1-1%201-1c3%200%203%200%202-4%200-7%201-8%209-8%206%200%207%200%2011-4l5-4h-6l-7-1-5-2c-2%200-3-1-3-3l-1-6-2-8c-2-11-6-14-11-8m53%2022c0%202-1%203-4%204l-5%201-3%201c-3%200-9%205-7%206h-1l-2%201%206%201c5%200%205%200%202-1s17-2%2043-3c17%200%2020-2%208-4-16-3-15-3-24-1h-6l-2-4c-4-5-4-5-5-1m160%205l-16%202-2%201%202%202c2%201%203%208%201%209-1%201-4%209-3%2010l2%202c1%201%200%201-1%201-6%200-4%204%203%204l2%201h3l3%201h1l17-2%2019-1c5%200%206-2%201-2-2%200-3%200-2-1%202-1%200-5-3-5-2-1-1-1%202-1%205%200%205%200%202-6-1-3-2-3-4-3a506%20506%200%2001-24-2c5-1%209-3%209-4l5-1c3%200%204%200%203-1-2-1-2-1%201-1l6-1%202-1-13-2-16%201m74%2040c-2%201-2%203-2%206l-1%205-1%2011-2%209v2c2%200%204%206%204%2010l3%203%202%202%201%201%201-1%201-2%202-2c0-2%200-2%201-1h1c-1-1%200-2%201-3%201-2%201-2-1-4v-2l2-2v-9c1-17-6-30-12-23&#x27;%20fill=&#x27;%23d3d3d3&#x27;%20fill-rule=&#x27;evenodd&#x27;/%3e%3c/svg%3e" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source type='image/webp' srcset="/static/0be878018e231c73eff40132343d0959/e4875/cover.webp 1040w,
/static/0be878018e231c73eff40132343d0959/ecdd3/cover.webp 2080w,
/static/0be878018e231c73eff40132343d0959/12eb1/cover.webp 4160w,
/static/0be878018e231c73eff40132343d0959/f9a87/cover.webp 5184w" sizes="(max-width: 4160px) 100vw, 4160px" /><source srcset="/static/0be878018e231c73eff40132343d0959/d5c54/cover.jpg 1040w,
/static/0be878018e231c73eff40132343d0959/f734f/cover.jpg 2080w,
/static/0be878018e231c73eff40132343d0959/ba537/cover.jpg 4160w,
/static/0be878018e231c73eff40132343d0959/cf7e6/cover.jpg 5184w" sizes="(max-width: 4160px) 100vw, 4160px" /><img loading="lazy" sizes="(max-width: 4160px) 100vw, 4160px" srcset="/static/0be878018e231c73eff40132343d0959/d5c54/cover.jpg 1040w,
/static/0be878018e231c73eff40132343d0959/f734f/cover.jpg 2080w,
/static/0be878018e231c73eff40132343d0959/ba537/cover.jpg 4160w,
/static/0be878018e231c73eff40132343d0959/cf7e6/cover.jpg 5184w" src="/static/0be878018e231c73eff40132343d0959/ba537/cover.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption><a href="https://unsplash.com/photos/uf4oyaimWwg" target="_blank" rel="noopener noreferrer">Photo by <!-- -->Jamison McAndie</a></figcaption></figure><div><p>During the past few weeks, I had the chance to introduce many of my colleagues
to React Hooks.</p>
<p>The overall feedback is that they are an improvement over class components. Code
written with Hooks looks more natural to follow and to reason about.</p>
<p>There is, however, one common complain whenever I explain the predefined Hooks:
<code class="language-text">useEffect</code> is complicated to understand.</p>
<p>Indeed its API is not as straightforward as other Hooks, although once one
understands how it works, it is flexible and powerful.</p>
<p>In this post, I <em>do not</em> want to explain how it works—for that you can check the
<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="nofollow noopener noreferrer">official docs</a>. Instead, I want to
go through common patterns and see how to convert them from a class-based
implementation to one using <code class="language-text">useEffect</code>.</p>
<h2>Do Something When the Component Mounts</h2>
<p>This is possibly the most common pattern in class components. We do this all the
time, for example, to fetch some data.</p>
<p>Here's how it looks like in a class component:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> bar<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">fetchFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">fetchBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/bar"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> bar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span><span class="token plain-text">, </span><span class="token punctuation">{</span>bar<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In this example we're simply fetching two values, <code class="language-text">foo</code> and <code class="language-text">bar</code>, when the
component mounts. If you are unfamiliar with <code class="language-text">async</code>/<code class="language-text">await</code> you can read more
about it
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank" rel="nofollow noopener noreferrer">here</a>.</p>
<p>The same code would look like this with React Hooks:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> setFoo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>bar<span class="token punctuation">,</span> setBar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFoo</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/bar"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setBar</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fetchBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span><span class="token plain-text">, </span><span class="token punctuation">{</span>bar<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>It's hopefully easy to see that there are several similarities between the two
implementations.</p>
<p>The important thing to notice is the second parameter we're passing to
<code class="language-text">useEffect</code>: an empty array. We do this to tell <code class="language-text">useEffect</code> to run only once.</p>
<p>Although the code works, it has a problem. We're grouping the code that deals
with <code class="language-text">foo</code> with the one that handles <code class="language-text">bar</code>. This is a necessity when we're
working with class components because we have to put all our logic within the
<code class="language-text">componentDidMount</code> method.</p>
<p>With Hooks we can separate our code by concerns. Let's refactor the previous
example to see this idea in action:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> setFoo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/foo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFoo</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>bar<span class="token punctuation">,</span> setBar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"/bar"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setBar</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>foo<span class="token punctuation">}</span><span class="token plain-text">, </span><span class="token punctuation">{</span>bar<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We've reorganized the order of our declarations so that we end up with two
<em>visual blocks</em>. The first one about <code class="language-text">foo</code> and the second about <code class="language-text">bar</code>.</p>
<p>Note how we can call <code class="language-text">useEffect</code> more than once.</p>
<h2>Do Something When the Component Unmounts</h2>
<p>Most times after you set up some sort of listener when the component mounts you
have to unregister it if the component unmounts. Failing to do so might result
in memory leaks and other unintended behavior.</p>
<p>First, let's see the class version:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">handlClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Clicked!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>With <code class="language-text">useEffect</code> you can do the same by returning a function:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">handlClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Clicked!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>Do Something When One or More Props Change</h2>
<p>Our last example is about reacting to prop changes. With a class you would have
to use <code class="language-text">componentDidUpdate</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span> user<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>userId <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// We have to fetch the user again</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>With <code class="language-text">useEffect</code> we can pass <code class="language-text">userId</code> in the list of parameters to watch:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You can pass as many values as you want in the array. They don't necessarily
have to be props, in fact they can come from anywhere.</p></div></article><footer class="blog-post__Footer-sc-7gkdnd-1 duvUWk">Would you like to have a civil discussion about this post? Hit me up on<!-- --> <a href="https://twitter.com/Gpx" target="_blank" rel="noopener noreferrer">twitter</a>.</footer></div><div class="newsletter-form__Card-a2ms4a-0 fscSeJ"><h1 class="newsletter-form__Title-a2ms4a-3 KHPza">Subscribe to my newsletter</h1><div class="newsletter-form__Sub-a2ms4a-4 cocZZB">No spam. Unsubscribe when you want.</div><form action="https://buttondown.email/api/emails/embed-subscribe/gpx" method="post" target="popupwindow" class="newsletter-form__Form-a2ms4a-2 kvNPcB"><div class="newsletter-form__InputGroup-a2ms4a-5 dYhHPN"><label for="bd-email">Email</label><input type="email" name="email" id="bd-email" placeholder="Your email" required=""/><input type="submit" value="Subscribe" class="newsletter-form__Button-a2ms4a-1 eyKXbm"/></div><input type="hidden" value="1" name="embed"/></form></div><div class="footer__Container-sc-1abtvul-0 jBIpkR"><div class="footer__Content-sc-1abtvul-1 ihWmWm"><a href="/">Home</a>·<a href="/rss.xml">RSS</a>·<a href="https://twitter.com/Gpx" target="_blank" rel="noopener noreferrer">Twitter</a>·<a href="https://github.com/Gpx" target="_blank" rel="noopener noreferrer">GitHub</a></div><div class="footer__Copy-sc-1abtvul-2 bcrfyt">© 2014–<!-- -->2020<!-- --> Giorgio Polvara</div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-40681255-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/making-sense-of-useeffect/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-04a92f08d6fc44f9844d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-e30b8e87a4bdbd393cf0.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-823b0b2f1756e4d4d7a7.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-823b0b2f1756e4d4d7a7.js" async=""></script><script src="/cd7d5f864fc9e15ed8adef086269b0aeff617554-b178ff70968fed9b073a.js" async=""></script><script src="/styles-b729c27faa6284e9ff45.js" async=""></script><script src="/app-04a92f08d6fc44f9844d.js" async=""></script><script src="/framework-c88d07efb40e009babfb.js" async=""></script><script src="/webpack-runtime-109c4be61e355b7b21f8.js" async=""></script></body></html>