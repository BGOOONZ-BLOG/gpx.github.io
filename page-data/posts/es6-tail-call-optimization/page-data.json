{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/es6-tail-call-optimization/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://www.polvara.me"}},"markdownRemark":{"html":"<p>ECMAScript 6 a.k.a. ECMAScript 2015 a.k.a. the new version of JavaScript is\ngetting closer and closer to ratification, the current goal is to have the new\nstandard ready in June 2015. This is a big step forward for JavaScript that is\nbecoming a modern language, suitable for all the uses we need.</p>\n<p>If you follow tech news you know about some of these changes:\n<a href=\"http://es6-features.org/#ClassDefinition\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">classes</a>,\n<a href=\"http://es6-features.org/#SymbolExportImport\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">modules</a>,\n<a href=\"http://es6-features.org/#SpreadOperator\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">spread operators</a>… In this post I will\nanalyze one less known feature: tail call optimization.</p>\n<h2>CS 101: The Stack Frame</h2>\n<p>Let’s analyze this simple snippet of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bar called\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"baz called\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">baz</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"baz\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"all done\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>When we invoke <code class=\"language-text\">foo</code>, a new stack frame is created in memory. A stack frame is\nsimply a portion of memory where we store some values necessary to execute the\nfunction, for instance local variables, arguments and most importantly the\ncaller of the function, so when the execution is done the <em>callee</em> can return to\nit.</p>\n<p>Let’s see this in action using\n<a href=\"https://developer.chrome.com/devtools/docs/javascript-debugging\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chrome’s debugger</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 562px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca2874801a019d19c9380c738ad0f627/6e88f/debug1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.987730061349694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2UlEQVQoz21R226bQBDl//+mkvvQSlXUqCm242CTxLGNYbntDVh2AS9xuNkZcPPWo8NqeDhzZs4Y4YQgDDDGlFLyBfiNR0SYUDwiZpR4z/bLsz2fm2vLcg57w3U9HJGEpiITaZoWZXmjlDJJEj8IDwjvjmjvONAGBeFu7xw9lAlJGTeyLFOJjN2IEsoJaaqq6/vrF0LvsHi4t5bm8e0lOO4EjXIWS46h3q5XBuc8VxJTDG6nQnVV1Sh1rsoBpN072d1Z5sxeft9aPzbz2Zv1E21/24uZ9ffb63JmMMa00tfmWuu6rvVlGCbLy/i0Wmd/hDB9dIfQL0oeODMTZkJRqNWHXhmwWMYz583BmHCMPwrVNg20GNVDm7jr7eM9PqyZa5fEOTEXqLmX+VtysAwIVBZSSKFr/X469frUlsW5qi6XUU4oe1pvICOeJFIpVRQ3ijxPs8wIo1hlZVO1hSxVUXZdP0xDgzXIgzBcLFePq6f5fAl3EULApHAUiBn2NTiNKpXHPoojnwZul5K2zIeuuaXNOduDr+tO9EBPGYMJ4JDQyJjbbONIjzV+MgQTfdoi3kOBWKfP3ZjeBMhhgG9a5wZjc6xevcrD5zC5BDem/wrE+vrcT+Lrf/EJz9BX+SVeGLcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"debug1\"\n        title=\"debug1\"\n        src=\"/static/ca2874801a019d19c9380c738ad0f627/6e88f/debug1.png\"\n        srcset=\"/static/ca2874801a019d19c9380c738ad0f627/222b7/debug1.png 163w,\n/static/ca2874801a019d19c9380c738ad0f627/ff46a/debug1.png 325w,\n/static/ca2874801a019d19c9380c738ad0f627/6e88f/debug1.png 562w\"\n        sizes=\"(max-width: 562px) 100vw, 562px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In the orange rectangle, you have the stack frame and also a list of local\nvariables. It’s not exciting but let’s see what happens when we call <code class=\"language-text\">foo</code>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 559px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/afcef361171cddae11a2b27a3cc28682/a65ce/debug2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.601226993865026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2klEQVQoz2WR147bMBBF9f9fka9IECB5SRDD66Jiy0US1SiqUCKpYlltVXbiXS8C5IB8YJm5l5eS/8DzPUJIFEXhE1gGGMMgYRSQ8P0UadpB09brtaIopmlKCNm+F4ZBSimLk5SLQuQlz4uMiyhhruebNr6a6GoY0Mpx3cv1ihDKsgx6STTNVjL/+sP7/of8XOH9Md9Zg2JPsj2rZqOfrc12s9vLoOO6XpbSLE0ZY67r6rouJUmScY5DAoKVyPuyaoW4l3VbsXb/xdp826iX88W4GEg/XfWzAS42O/nX79XLdi/FcXwv6mVYmjtQz/O0fDDDIDHfaoZyQvLROlk+TkSaNzZOTIe4AZUopVmSmWeTkDAhpCvyoe/n6aMFYxn2A845PLJtmr7ruraFCXeGoZeCIICMmGD1vW5ut7G+DWXRVtX8V3tu25Ylom26qgZT89PUAh2q203ycVCycoCSvASmcVz+IYpj9Xi0kA3KRVGUT7gQEJuURFgw7iDHdhwfoSYK75yBq/di38frly2kraia52POGH2QpvC1VFof4pjm4/j69DTP4/jpEGMsK5qiHnaycjpfTNOCaCACkIVvklSrpKwahm75j2ma+r5/fTCO4wCXOshp+Nx5A1UCWkgjS42QAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"debug2\"\n        title=\"debug2\"\n        src=\"/static/afcef361171cddae11a2b27a3cc28682/a65ce/debug2.png\"\n        srcset=\"/static/afcef361171cddae11a2b27a3cc28682/222b7/debug2.png 163w,\n/static/afcef361171cddae11a2b27a3cc28682/ff46a/debug2.png 325w,\n/static/afcef361171cddae11a2b27a3cc28682/a65ce/debug2.png 559w\"\n        sizes=\"(max-width: 559px) 100vw, 559px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>A new stack frame gets created. Notice that the other frame is still there, we\nwill need it later. After <code class=\"language-text\">foo</code> calls <code class=\"language-text\">bar</code> that calls <code class=\"language-text\">baz</code>, we are in this\nsituation:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 559px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/95bcdd554cd2c58b61c43a3111de26d6/a65ce/debug3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.601226993865026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1ElEQVQoz01Sf5eiIBT1+3+l+WfPaWtspnIrpwx/piAIKEqaOpYMY9vs3vMOPA7c++DyjPOE6BxBCNM0RU/oZaIRxxClCUSPXW+73W23pmlalgUAMDzPhzHKUsoZp5SWVfWIoiiyLIuiEPixA7zT6aSlgjB0HMdzXcaY1jL0JLIi8eIUpQShXsrhdlNPRFFkLs3Veg2AG4YBpRmjlHOmc9u2DUJILgqYQl3tUopByl6IVlbj+E0Grm++bY4nbwr34wh0vC5Xs/nr8n1jYIxrUateNXXTNPV4v6v/kJdNkol2UHWnmk91ace6V5AIx4vPiBv6YYwwcABJggiEnRCfff8jIWQbQUZ4hVmVZqKQ3bVXiBRBjFMqDG2DlEVZ8a5r+uai2nqsy6GR062V9sHaf9hHsD+AIII4y1leIkx14Iwb51h7WELYe+fSjQXOB1KprFREjLgYRXXhJL82rTb/dp+MfJgxZUaKEuvAX2bey8L/NQf2JrF2bB+0JzQ6yQ3TKomhKMrmeh2+cZtwl/LCeW6YO8xzodQw/rPp/qOvG+Vttd7tbf1nhGD2hO6IjFLjj1sRJvu+06fHifR3nNhhFM0Xprl8n/1e+H6gL6+ZXBfNc92FX2O0WzczUVXiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"debug3\"\n        title=\"debug3\"\n        src=\"/static/95bcdd554cd2c58b61c43a3111de26d6/a65ce/debug3.png\"\n        srcset=\"/static/95bcdd554cd2c58b61c43a3111de26d6/222b7/debug3.png 163w,\n/static/95bcdd554cd2c58b61c43a3111de26d6/ff46a/debug3.png 325w,\n/static/95bcdd554cd2c58b61c43a3111de26d6/a65ce/debug3.png 559w\"\n        sizes=\"(max-width: 559px) 100vw, 559px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Two new stacks are created, one for <code class=\"language-text\">bar</code> and one for <code class=\"language-text\">baz</code>, those stacks are\nlisted in what is called call stack. The call stack is very useful when you\ndebug because it tells you the history of your program: which function called\nwhich other function. After <code class=\"language-text\">baz</code> has done its job it returns back to <code class=\"language-text\">bar</code>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 559px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6ef47025ef136174300f57b2a3567425/a65ce/debug4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.601226993865026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABy0lEQVQoz22Ra4+qMBCG+f9/a3MS9KCI7iKUcqdAaaEtCKJyOeMaN/vhPHkzbdPMdPqOFn8TxVGWZXmekzdwTIEkyUieZuR1iy3raFm6rpumiRDSMPazhNC84oxXVSWVeqlpGkppFIXITxyEXdeFUkEYOo6DPY8xBrU0WARtUpzkJC8JubXtY5rWN1EU6frGMHYuQoEfVJQyVnHOwjA4nU5aWZa1qNM8E1J1Qtzb9ibE0Kp5eSa7yN8aB+QFT+Hw7HpfZ6Rvdx9/9O3fvVYUxaAu67SOwzBe+2VZ1l+I7upnrGx6UEYVV7fLbY0Is704IlwrKQ2jyjBcG2UIpVXecDnKbpL9AirKynFdz/c9jMHBpqm7tuWMUVpC81qcpBu7/rAqw23Ns/p01OmzMW1phfMxnLNS5KSQsmV1/Xg85mmCOM3z8s0zuRdqHR5D1w4XtS7Tr66X69DTgveX4dL38zz/XPT9IKXSyjytGcdegP0w8nBPSMfrcbyBYaAkSXd788t20pTAXOo3MFQYpKYfi4IKaOdt1LJM049tcZJstgbkG3szjhMpJYe/MgYRnNYOnqK8vd/H9X/Ay6ZpHazj/mCZhyNsoJwQ4lXiH1kGWfGu8QH2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"debug4\"\n        title=\"debug4\"\n        src=\"/static/6ef47025ef136174300f57b2a3567425/a65ce/debug4.png\"\n        srcset=\"/static/6ef47025ef136174300f57b2a3567425/222b7/debug4.png 163w,\n/static/6ef47025ef136174300f57b2a3567425/ff46a/debug4.png 325w,\n/static/6ef47025ef136174300f57b2a3567425/a65ce/debug4.png 559w\"\n        sizes=\"(max-width: 559px) 100vw, 559px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As you can see, the stack frame for <code class=\"language-text\">baz</code> is deleted because we no longer need\nit anymore. Every time a function returns, its stack frame gets deleted. After\nour program is done, the call stack will be empty:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 559px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f0fd8e48b58d582a284db08bf31bc69/a65ce/debug5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.601226993865026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz4WR63KbMBSE9f7P1Wk9aR1iJ6U1wTYgoQsXCYGwA+bShY4zafuj3zCaI2n2nNVC4pUojiml6QcYYzjH+rvmnEshjvuFzWbjed7hcCBheGRJqniWqVwIaa2t7EJZltCcz+fgFYT40P0cRb7vB0GQZRmakjzPjdI0THgqJE+7ur4Nw3wHg7febv/8co5iypjWulpJKP3x80CklKXRjDMMbIy51XVnzLWup3mepqlpnK0XmgaXWimF+nq9XlaIEMIZN3dz69q2ddM4vo+F2BjD8RipMBYrwIlzDr2wEuxzmQd+AIeSsbfK9F13b7GI05RzIavKoi6KApMxs10hiEFXutCFa92laQbX9LaC7XGC8TmKok+fvzx83T7tnill0CMqtQLLJE6oLWwPiVlCHj+kBeI42T56j97u4dv25bsfhCF+AeYj5kUseaKL8hSejqdTHIYXnrZlAefrm8fLPRuEhEzwVBTdSt/3ZLMXQplhuE3vMQ3DtHoeR/j4w8hfkKdXq4q679/+vfuv+Bc1R2Zft//0GQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"debug5\"\n        title=\"debug5\"\n        src=\"/static/4f0fd8e48b58d582a284db08bf31bc69/a65ce/debug5.png\"\n        srcset=\"/static/4f0fd8e48b58d582a284db08bf31bc69/222b7/debug5.png 163w,\n/static/4f0fd8e48b58d582a284db08bf31bc69/ff46a/debug5.png 325w,\n/static/4f0fd8e48b58d582a284db08bf31bc69/a65ce/debug5.png 559w\"\n        sizes=\"(max-width: 559px) 100vw, 559px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Maximum Call Stack Size</h2>\n<p>Now that you have a general understanding of what stack frame and call stack\nare, we can see an error you may encounter while programming.</p>\n<p>Imagine you have this function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you call <code class=\"language-text\">foo</code> with a positive integer, it will simply call itself decreasing\nthe number until it reaches zero. This is how the call stack behaves if we\nexecute <code class=\"language-text\">foo(10)</code>:</p>\n<p>\n        <div class=\"embedVideo-container\">\n            <iframe\n              width=\"560\"\n              height=\"316\"\n              src=\"https://www.youtube.com/embed/oorN1hGcgKs?rel=0\"\n              class=\"embedVideo-iframe\"\n              style=\"border:0\"\n              allowfullscreen\n            ></iframe>\n        </div></p>\n<p>As you can see, 10 stack frames get created until <code class=\"language-text\">n</code> reaches zero, at which\npoint the functions begin to return and all the stacks get deleted.</p>\n<p>So if <code class=\"language-text\">n</code> is 10, we have 10 stack frames, if <code class=\"language-text\">n</code> is 100, we have 100 frames and\nso on. What happens if <code class=\"language-text\">n</code> is 100,000?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 423px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/254549d007acf8e62e26e6c4ad9ff2ca/f687d/debug6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.202453987730062%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAa0lEQVQI1zWK0Q6CMBAE+f/vM5oYJNYehdBCqyANd9tTMPFlMpPdaplfRN35+j5dnnnNnwJlVhEFivBOLUVx5N9/sh+Yqxz8SnZrms25JSa+1WyN+AEp8cMwWQQvfYcYpSXESVyLMRyTuX8BRqlxp9x2g2oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ungaught Ranger Error: Maximum call stack size exceeded\"\n        title=\"Ungaught Ranger Error: Maximum call stack size exceeded\"\n        src=\"/static/254549d007acf8e62e26e6c4ad9ff2ca/f687d/debug6.png\"\n        srcset=\"/static/254549d007acf8e62e26e6c4ad9ff2ca/222b7/debug6.png 163w,\n/static/254549d007acf8e62e26e6c4ad9ff2ca/ff46a/debug6.png 325w,\n/static/254549d007acf8e62e26e6c4ad9ff2ca/f687d/debug6.png 423w\"\n        sizes=\"(max-width: 423px) 100vw, 423px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As said, every stack frame gets created in memory; unfortunately, a program has\na limited amount of memory assigned, so it’s possible that the call stack\nbecomes too big. In this case, we have an error and the program crashes.</p>\n<h2>Tail Call Optimization</h2>\n<p>Let’s keep our focus on the previous function. As you can clearly see, the last\nthing it does before returning is to call itself. This means that, when the\ncalled function returns, <code class=\"language-text\">foo</code> will do nothing, just immediately return to its\ncaller.</p>\n<p>This kind of code allows a <code class=\"language-text\">tail call optimization</code>. With this optimization, if\nthe last thing a function does is to call another function, instead of creating\na new stack frame the callee will use the caller function’s frame.</p>\n<p>In our case, <code class=\"language-text\">foo(n-1)</code> will simply use <code class=\"language-text\">foo(n)</code>’s frame as will <code class=\"language-text\">foo(n-2)</code> etc.\nIn the end, <code class=\"language-text\">foo(0)</code> will simply return directly to the main program instead of\ngoing through the entire call stack.</p>\n<p>This is not only faster but it requires far less memory: instead of creating\n100,000 frames we simply have 1 that gets re-used. So our call to <code class=\"language-text\">foo(100000)</code>\nwill get executed without exceptions.</p>\n<p>If you think it’s unlikely you’ll write code like this, think again. Functional\nprogramming is\n<a href=\"https://medium.com/@jugoncalves/functional-programming-should-be-your-1-priority-for-2015-47dd4641d6b9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rising in popularity</a>\nand makes heavy use of tail calls. One of the reasons it hasn’t been used too\nmuch in JavaScript was exactly the lack of tail call optimization.</p>\n<p>Also, many languages are now transpiling to JavaScript. Think of Unreal Engine,\nwhich is a C/C++ program, now\n<a href=\"https://blog.mozilla.org/blog/2014/03/12/mozilla-and-epic-preview-unreal-engine-4-running-in-firefox/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">running in Firefox</a>.\nThose platforms will benefit from this optimization as it’s already a given for\nthem.</p>\n<h2>Current Implementations</h2>\n<p>This is the part where we usually blame IE for not supporting the new cool\nfeature, unfortunately this time we have to blame everyone:</p>\n<p><a href=\"https://kangax.github.io/compat-table/es6/#proper_tail_calls_(tail_call_optimisation)\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.883435582822086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwklEQVQI1wG3AEj/AO3t7e/v7uvt7vHnzfDasOfYu+7fxPLly/Xy2Ovt2/PszfnuyOfjxe7t0fb11vHt1vby2/Pu0eXguunkugDp6Onu7u/k3eDl2MLi47bq39Pm2dnl2dre2OnJzOrrxKf30q7e0rPW3Lvf4cfi2OHk3Oro3ujY1cjc27sA6ufq6e/x44iU62tqypdf7GZZ82Fe8mNf8WBg+nl38mVk/IaG9m1r+3Zz/n188mdm+XJx8mhn71NP9mpovwqN9lqzZ30AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Usage table for tail-call optimization, no browser implements it\"\n        title=\"Usage table for tail-call optimization, no browser implements it\"\n        src=\"/static/a868e005ef29c04190a8b7d5cc4ed780/a6d36/debug7.png\"\n        srcset=\"/static/a868e005ef29c04190a8b7d5cc4ed780/222b7/debug7.png 163w,\n/static/a868e005ef29c04190a8b7d5cc4ed780/ff46a/debug7.png 325w,\n/static/a868e005ef29c04190a8b7d5cc4ed780/a6d36/debug7.png 650w,\n/static/a868e005ef29c04190a8b7d5cc4ed780/e548f/debug7.png 975w,\n/static/a868e005ef29c04190a8b7d5cc4ed780/3c492/debug7.png 1300w,\n/static/a868e005ef29c04190a8b7d5cc4ed780/947d2/debug7.png 1773w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></a></p>\n<p>As you can see, only <a href=\"https://babeljs.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Babel</a> partially supports it. This is\nof course about to change in the near future.</p>\n<p>If you want to learn more about tail call optimization check the\n<a href=\"https://people.mozilla.org/~jorendorff/es6-draft.html#sec-tail-position-calls\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ES6 draft</a>.</p>","timeToRead":5,"frontmatter":{"title":"ES6 Tail Call Optimization","cover":{"file":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwACBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAAB5qipkbNP/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAERIhMf/aAAgBAQABBQJKMwjDamiOFp//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAADAQAAAAAAAAAAAAAAAAAAICEx/9oACAEBAAY/Ai4v/8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERITFhobH/2gAIAQEAAT8hkU7Y8EibEEV6RFLA8dGjp//aAAwDAQACAAMAAAAQVO//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QsY//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QrK//xAAdEAEBAAIBBQAAAAAAAAAAAAABEQAhQTFRYYHw/9oACAEBAAE/EByr5Ih38mElAxT7XGOgAGi7e80hlC611kmPaDcqokUsrP/Z","aspectRatio":1.5007215007215007,"src":"/static/6abcfffa25560660a71305103867626c/5de81/cover.jpg","srcSet":"/static/6abcfffa25560660a71305103867626c/8d4f6/cover.jpg 1040w,\n/static/6abcfffa25560660a71305103867626c/ae915/cover.jpg 2080w,\n/static/6abcfffa25560660a71305103867626c/5de81/cover.jpg 4160w,\n/static/6abcfffa25560660a71305103867626c/de5d6/cover.jpg 5184w","srcWebp":"/static/6abcfffa25560660a71305103867626c/772eb/cover.webp","srcSetWebp":"/static/6abcfffa25560660a71305103867626c/026d6/cover.webp 1040w,\n/static/6abcfffa25560660a71305103867626c/ff470/cover.webp 2080w,\n/static/6abcfffa25560660a71305103867626c/772eb/cover.webp 4160w,\n/static/6abcfffa25560660a71305103867626c/d7226/cover.webp 5184w","sizes":"(max-width: 4160px) 100vw, 4160px"}}},"author":"Noah Baslé","link":"https://unsplash.com/photos/kqB7IDljjMI","alt":null,"hide":null}},"fields":{"slug":"/posts/es6-tail-call-optimization/"}}},"pageContext":{"slug":"/posts/es6-tail-call-optimization/"}}}