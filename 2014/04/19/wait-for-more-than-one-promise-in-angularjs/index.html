<!doctype html> <html> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>Wait for more than one promise in AngularJS</title> <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel=stylesheet> <link href="../../../../stylesheets/normalize-6197e73d.css" rel=stylesheet /><link href="../../../../stylesheets/all-ad0e08ca.css" rel=stylesheet /> <script src="../../../../javascripts/all-da39a3ee.js"></script> </head> <body class="x2014 x2014_04 x2014_04_19 x2014_04_19_wait-for-more-than-one-promise-in-angularjs x2014_04_19_wait-for-more-than-one-promise-in-angularjs_index"> <p>While developing a web application it may happen that you need the results from more than one asynchronous request. Let&rsquo;s say that in a blog application you want to display for every user the list of posts he wrote. So you need to ask for <code>/users</code> and <code>/posts</code>. When you get both those information you can do the mapping.</p> <p>One way to go is this:</p> <pre class="highlight javascript"><code><span class="kd">function</span> <span class="nx">SomeController</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">userService</span><span class="p">,</span> <span class="nx">postService</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">userService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">users</span><span class="p">;</span> <span class="c1">// Save it for later</span>
    <span class="nx">postService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">();</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">posts</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">posts</span> <span class="o">=</span> <span class="nx">posts</span><span class="p">;</span>

    <span class="c1">// Do the mapping</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre> <p>The code above is not efficient because the two request are run one after the other. We can do better using the <a href="https://docs.angularjs.org/api/ng/service/$q#all"><code>$q.all()</code></a> method.</p> <p>This method takes an array or an object of promises and combines them into a single promise.</p> <p>Let&rsquo;s see how we can improve the code above:</p> <pre class="highlight javascript"><code><span class="kd">function</span> <span class="nx">SomeController</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$q</span><span class="p">,</span> <span class="nx">userService</span><span class="p">,</span> <span class="nx">postService</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$q</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">userService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">(),</span> <span class="nx">postService</span><span class="p">.</span><span class="nx">getAll</span><span class="p">()])</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">posts</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="c1">// Do the mapping</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre> <p>As you can see this is cleaner and the code runs faster because the two AJAX request will be executed in parallel.</p> <p>I created <a href="http://jsbin.com/poboj/2/edit?js,console">this JS Bin</a> as an example. It uses <a href="https://docs.angularjs.org/api/ng/service/$timeout"><code>$timeout</code></a> instead of an AJAX call but the idea is the same.</p> </body> </html>