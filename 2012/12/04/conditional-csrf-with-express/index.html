<!doctype html> <html> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>Conditional CSRF control with Express</title> <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel=stylesheet> <link href="../../../../stylesheets/normalize-6197e73d.css" rel=stylesheet /><link href="../../../../stylesheets/all-ad0e08ca.css" rel=stylesheet /> <script src="../../../../javascripts/all-da39a3ee.js"></script> </head> <body class="x2012 x2012_12 x2012_12_04 x2012_12_04_conditional-csrf-with-express x2012_12_04_conditional-csrf-with-express_index"> <p>Some days ago I had to develop a small authentication app in <a href="http://nodejs.org">Node</a> with the <a href="http://expressjs.com/">Express</a> framework. Basically it exposes just one JSON API, something like <code>POST /user_data</code>. It accepts two parameters: <code>user</code> and <code>password</code> and returns the data if they are correct.</p> <p>Users are created by an administrator using a web interface. Of course every form is protected from <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a> using <a href="http://expressjs.com/api.html#csrf">Express&rsquo; middleware</a>.</p> <p>Following the official guide you have to do so in order to enable it:</p> <script src="https://gist.github.com/Gpx/5474596.js"></script> <p>That&rsquo;s correct if you want to validate <strong>every</strong> POST request. In my case I needed to skip the CSRF control for my API. So I defined my own middleware function that skips <code>/user_data</code> requests:</p> <script src="https://gist.github.com/Gpx/5474621.js"></script> <p>In this way CSRF token validation will be applied only on POST requests not in the <code>whitelist</code> array.</p> <p>If you want you can also skip validation for every AJAX requests. Here&rsquo;s the code:</p> <script src="https://gist.github.com/Gpx/5474611.js"></script> </body> </html>